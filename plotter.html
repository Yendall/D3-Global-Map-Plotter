<!DOCTYPE html>
<meta charset="utf-8">
<style>
    .graticule {
        fill: none;
        stroke: #777;
        stroke-width: 0px;
        stroke-opacity: 0.5;
    }
    .land {
        fill: #99d8c9;
        stroke: #636363;
        stroke-width: 0.5px;
    }
    .boundary {
        fill: none;
        stroke: #636363;
        stroke-width: 0.5px;
    }
</style>

<body>
<label>Input Data: </label>
<input type="file" id="file-input" />
<button onClick="setupMap()">Setup Map</button>
<br>
<input type="hidden" id="file-content">

<script src="JS/d3.v4.0.0-alpha.50.min.js"></script>
<script src="JS/topojson.v1.min.js"></script>
<script>
    document.getElementById('file-input')
            .addEventListener('change', readSingleFile, false);

    function readSingleFile(e) {
        var file = e.target.files[0];
        if (!file) {
            return;
        }
        var reader = new FileReader();
        reader.onload = function(e) {
            var contents = e.target.result;
            document.getElementById("file-content").value = contents;
        };
        reader.readAsText(file);

    }

    function getColour(value) {
        if (value < 0) {
            return "#E50610";
        } else if (value == 0) {
            return "#E57B00";
        } else if (value > 0) {
            return "#0DE780";
        }
    }

    function between(x, min, max) {
        return x >= min && x <= max;
    }

    function getProportion(value) {
        if (between(value, 0, 30)) {
            return 1;
        }
        if (between(value, 30, 60)) {
            return 1.5;
        }
        if (between(value, 60, 100)) {
            return 2;
        }
        if (between(value, 100, 300)) {
            return 2.5;
        }
        if (between(value, 300, 500)) {
            return 3.0;
        }
        if (between(value, 500, 1000)) {
            return 3.5;
        }
        if (between(value, 1000, 2000)) {
            return 5.0;
        }

    }

    function setupMap() {

        var width = 960,
                height = 480;
        var projection = d3.geoEquirectangular()
                .scale(height / Math.PI)
                .translate([width / 2, height / 2]);
        var path = d3.geoPath()
                .projection(projection);
        var graticule = d3.geoGraticule();
        var svg = d3.select("body").append("svg")
                .attr("width", width)
                .attr("height", height)
                .attr("id", "dank_meme");
        svg.append("path")
                .datum(graticule)
                .attr("class", "graticule")
                .attr("d", path);

        d3.json("JSON/world-50m.json", function(error, world) {
            if (error) throw error;

            svg.insert("path", ".graticule")
                    .datum(topojson.feature(world, world.objects.land))
                    .attr("class", "land")
                    .attr("d", path);

            svg.insert("path", ".graticule")
                    .datum(topojson.mesh(world, world.objects.countries, function(a, b) {
                        return a !== b;
                    }))
                    .attr("class", "boundary")
                    .attr("d", path);
        });


        var places = JSON.parse([document.getElementById("file-content").value]);

        places.forEach(function(places) {


        });
        svg.selectAll(".pin").data(places)
                .enter().append("circle", ".pin")
                .style("fill", function(d) {
                    return getColour(d.Average_Tone);
                })
                .style("stroke", "#000")
                .style("stroke-width", 0.5)
                .attr("r", function(d) {
                    return getProportion(d.Mentions);

                })
                .attr("transform", function(d) {
                    return "translate(" + projection([
                                d.Longitude,
                                d.Latitude
                            ]) + ")";
                });

        

    }
</script>